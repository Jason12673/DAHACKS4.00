<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skill Up - 全屏响应式</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    
    <style>
        /* --- 1. 全局与布局 (Web 优先) --- */
        :root {
            --bg-cyan: #A0F0FA; 
            --bg-white: #FFFFFF;
            --primary-blue: #2D9CDB; 
            --text-dark: #000000;
            --font-main: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --color-gold: #FFC300;
            --color-silver: #C0C0C0;
            --color-bronze: #CD7F32;
        }
        
        * { box-sizing: border-box; }
        
        body { 
            margin: 0; 
            font-family: var(--font-main); 
            background-color: #f0f2f5; /* 网页背景色 */
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
        }

        /* 移除 #root-frame 的限制，让内容铺满全屏 */
        #root-frame {
            width: 100%;
            position: relative;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* --- 2. 认证页面 (保持居中) --- */
        #auth-screen {
            position: fixed; /* 固定在屏幕中央，不随内容滚动 */
            top: 0; left: 0; width: 100%; height: 100%;
            background: #BDEFEF; 
            z-index: 3000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: transform 0.5s ease-in-out;
            overflow-y: auto;
        }
        #auth-screen.hidden { transform: translateY(-100%); }

        .logo-text { font-size: 3.5em; font-weight: 900; color: #F4D03F; text-shadow: 2px 2px 0 #000; margin-bottom: 10px; font-style: italic; transform: rotate(-5deg); }
        .auth-form-container { width: 90%; max-width: 400px; margin-top: 20px; padding: 20px; background: rgba(255,255,255,0.2); border-radius: 20px; }
        .input-group { background: rgba(255,255,255,0.8); border-radius: 15px; padding: 12px 20px; margin-bottom: 15px; display: flex; align-items: center; color: #fff; }
        .input-group input { background: transparent; border: none; outline: none; color: #555; margin-left: 10px; width: 100%; font-size: 1em; }
        .input-group i { color: #555; opacity: 0.8; font-size: 1.2em; }
        
        .btn-main {
            width: 100%; padding: 15px; border: none; border-radius: 25px;
            background: linear-gradient(to right, #1abc9c, #2ecc71);
            color: white; font-weight: bold; font-size: 1em; cursor: pointer;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
            margin-top: 10px; margin-bottom: 20px; transition: transform 0.2s;
        }
        .btn-main:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4); }

        .auth-switch-text { text-align: center; font-size: 0.9em; color: #555; cursor: pointer; }
        .auth-switch-text strong { color: #2D9CDB; text-decoration: underline; }
        #signup-form { display: none; }

        /* --- 3. 主应用内容 (适应宽屏) --- */
        .app-content { display: none; opacity: 0; transition: opacity 0.5s; }
        .app-content.visible { display: block; opacity: 1; }

        .top-section {
            background: var(--bg-cyan);
            padding: 20px 5%; /* 左右留白 */
            padding-bottom: 40px;
            border-bottom-left-radius: 40px; border-bottom-right-radius: 40px;
            position: relative; z-index: 10;
        }

        /* 顶部导航，增加最大宽度限制，让内容不至于太分散 */
        .top-nav-container { max-width: 1200px; margin: 0 auto; }

        .top-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .stats-header-btn { display: flex; align-items: center; font-weight: bold; font-size: 1.4em; cursor: pointer; color: #333; }
        .user-avatar-top { width: 45px; height: 45px; background: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.6em; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        .notification-wrapper { position: relative; }
        .notification-badge { position: relative; cursor: pointer; margin-right: 15px; }
        .badge-dot { position: absolute; top: 0; right: 0; width: 10px; height: 10px; background: #FF3B30; border-radius: 50%; border: 2px solid var(--bg-cyan); }
        
        /* 通知气泡样式 - 修复了 flex 属性，确保内容垂直对齐 */
        .notif-bubble {
            position: absolute; top: 55px; right: 0; width: 320px;
            background: #85C1E9; 
            border-radius: 15px; padding: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            display: flex; /* 使用 flex */
            flex-direction: column; /* 垂直堆叠 */
            gap: 15px; /* 增加通知项间距 */
            z-index: 1000; border: 1px solid #333;
            visibility: hidden; opacity: 0; transform: translateY(-10px);
            transition: opacity 0.3s, transform 0.3s, visibility 0.3s;
        }
        .notif-bubble.show { visibility: visible; opacity: 1; transform: translateY(0); }
        
        /* 气泡箭头 */
        .notif-bubble::before { content: ''; position: absolute; top: -8px; right: 20px; width: 0; height: 0; border-left: 8px solid transparent; border-right: 8px solid transparent; border-bottom: 8px solid #333; }
        .notif-bubble::after { content: ''; position: absolute; top: -6px; right: 20px; width: 0; height: 0; border-left: 8px solid transparent; border-right: 8px solid transparent; border-bottom: 8px solid #85C1E9; }

        .search-pill {
            background: white; border-radius: 30px; padding: 15px 25px;
            display: flex; align-items: center; margin-bottom: 15px;
            max-width: 600px; margin: 0 auto 20px auto;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .search-pill input { border: none; outline: none; margin-left: 15px; width: 100%; font-size: 1.1em; }

        .nav-tabs { 
            display: flex; justify-content: center; gap: 25px; margin-top: -20px; 
            position: relative; z-index: 10;
        }
        .nav-tab {
            padding: 10px 25px; border: none; background: transparent;
            font-weight: 600; cursor: pointer; color: #555; font-size: 1.05em;
            border-radius: 20px; transition: all 0.3s ease;
        }
        .nav-tab.active { 
            background: #2D9CDB; color: white !important; 
            box-shadow: 0 6px 15px rgba(45, 156, 219, 0.4);
        }

        .content-area { 
            padding: 20px 5%; 
            max-width: 1200px; margin: 0 auto; /* 限制内容区域最大宽度 */
        }
        
        /* 响应式网格布局 */
        .grid-container { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); /* 桌面端至少三列 */
            gap: 25px; 
            margin-bottom: 30px; 
        }

        .cyan-card {
            background: var(--card-bg-cyan); border-radius: 20px;
            padding: 15px; display: flex; flex-direction: column;
            position: relative; overflow: hidden; min-height: 250px;
            transition: transform 0.2s, box-shadow 0.2s; cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .cyan-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(45, 156, 219, 0.2); }

        .card-img { width: 100%; height: 140px; object-fit: cover; border-radius: 15px; margin-bottom: 10px; }
        .card-title { font-weight: 800; font-size: 1.1em; margin-bottom: 5px; line-height: 1.3; min-height: 35px; color: #333; }
        .card-subtitle { font-size: 0.85em; color: #444; margin-bottom: 2px; }
        .card-stars { color: #F1C40F; font-size: 1em; }
        .btn-circle-plus {
            width: 38px; height: 38px; background: #2D9CDB; color: white;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            position: absolute; bottom: 15px; right: 15px; cursor: pointer; font-size: 1.5em;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: background 0.2s;
        }
        .btn-circle-plus:hover { background: #1a78b5; }

        /* 移动端适配 (小于 600px 时显示两列) */
        @media (max-width: 600px) {
            .grid-container { grid-template-columns: 1fr 1fr; gap: 15px; }
            .top-section { border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; }
            .search-pill { width: 100%; max-width: none; }
            .content-area { padding: 15px; }
        }

        /* 朋友列表 '加载更多' 按钮样式 */
        #load-more-friends {
            display: none; /* 默认隐藏，JS控制显示 */
            width: 100%; max-width: 400px; margin: 20px auto;
            padding: 15px; background: #d3f9d8; border: 2px solid #2ecc71;
            color: #2ecc71; font-weight: bold; border-radius: 15px;
            cursor: pointer; text-align: center;
            transition: background 0.2s;
        }
        #load-more-friends:hover { background: #c2f5cc; }

        /* 排行榜样式 */
        .leaderboard-list {
            list-style: none; padding: 0; margin: 0;
            max-width: 800px; margin: 0 auto;
        }
        .leaderboard-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px; background: white; border-radius: 15px;
            margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s; cursor: pointer;
        }
        .leaderboard-item:hover { transform: translateX(5px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        
        .rank-number {
            font-size: 1.5em; font-weight: 900; width: 40px; text-align: center;
        }
        .rank-number.gold { color: var(--color-gold); }
        .rank-number.silver { color: var(--color-silver); }
        .rank-number.bronze { color: var(--color-bronze); }

        .leader-info { display: flex; align-items: center; flex: 1; margin-left: 15px; }
        .leader-avatar { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; margin-right: 15px; }
        .leader-name { font-weight: bold; font-size: 1.1em; color: #333; }
        .leader-stats { text-align: right; }
        .leader-score { font-size: 1.2em; font-weight: 700; color: var(--primary-blue); }
        .leader-completed { font-size: 0.8em; color: #666; }

        /* --- 4. 全屏模态框 (Web 上的半屏/居中弹出) --- */
        .fullscreen-modal {
            position: fixed; /* 保持固定定位 */
            top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0, 0, 0, 0.4); /* 遮罩层 */
            z-index: 2000; transform: scale(0.9); opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: none;
            display: flex; align-items: center; justify-content: center;
        }
        .fullscreen-modal.open { transform: scale(1); opacity: 1; pointer-events: all; }
        
        .modal-content-wrapper {
            background: white; border-radius: 20px;
            width: 90%; max-width: 700px; max-height: 90%;
            overflow: hidden; display: flex; flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        /* 移动端全屏覆盖 */
        @media (max-width: 700px) {
            .fullscreen-modal { background: white; } /* 移除遮罩 */
            .modal-content-wrapper { width: 100%; height: 100%; max-width: none; max-height: none; border-radius: 0; }
        }
        
        .modal-header-cyan {
            background: var(--bg-cyan); padding: 20px; padding-top: 30px; padding-bottom: 30px;
            border-bottom-left-radius: 20px; border-bottom-right-radius: 20px;
            display: flex; align-items: center; justify-content: space-between; flex-shrink: 0;
        }
        .back-circle { width: 40px; height: 40px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.05); font-size: 1.2em; }
        .page-title { font-size: 1.5em; font-weight: 900; flex: 1; text-align: center; }

        /* --- 5. 技能详情页样式 --- */
        .detail-content-scroll { overflow-y: auto; flex-grow: 1; padding: 20px; }
        .skill-phase { padding: 0 20px 20px 20px; } /* 统一内边距 */
        
        /* Instruction List */
        .instructions-list { 
            list-style: none; padding: 0; margin: 20px 0 30px 0; 
            border-left: 3px solid #ccc; padding-left: 20px;
        }
        .instructions-list li { font-size: 1.05em; margin-bottom: 12px; color: #333; font-weight: 500; }
        .completion-card {
            background: #A0F0FA; border: 2px solid #000; border-radius: 15px;
            padding: 20px; text-align: center; margin-top: 20px; cursor: pointer;
            transition: background 0.2s;
        }
        .completion-card:hover { background: #85e0ee; }

        /* --- 6. 聊天弹窗 (Web 上的居中弹出) --- */
        #chat-modal {
            position: fixed; /* 固定在屏幕中央 */
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 2500; transform: scale(0.9); opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: none;
            display: flex; align-items: center; justify-content: center;
        }
        #chat-modal.open { transform: scale(1); opacity: 1; pointer-events: all; }
        
        .chat-content-wrapper {
            background: white; border-radius: 25px;
            width: 90%; max-width: 450px; height: 60%; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex; flex-direction: column;
        }

        /* 移动端全屏覆盖 */
        @media (max-width: 500px) {
            #chat-modal { background: white; }
            .chat-content-wrapper { max-width: none; width: 100%; height: 100%; border-radius: 0; }
        }

        .chat-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .chat-body { flex: 1; padding: 20px; background: #f9f9f9; overflow-y: auto; }
        .chat-message { background: #A0F0FA; padding: 10px 15px; border-radius: 15px; border-bottom-left-radius: 2px; max-width: 80%; margin-bottom: 15px; }
        .chat-footer { padding: 15px; background: white; display: flex; gap: 10px; flex-shrink: 0; }
        .chat-input { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ddd; outline: none; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <!-- 核心容器 -->
    <div id="root-frame">

        <!-- 1. 认证页面 -->
        <div id="auth-screen">
            <div style="text-align: center; margin-bottom: 20px;">
                <div class="logo-text">SKILL<br><span style="margin-left: 40px; color:#5DADE2;">UP</span></div>
            </div>

            <!-- Login Form -->
            <div id="login-form" class="auth-form-container">
                <div style="text-align:center; margin-bottom:20px; font-size:1.5em; font-weight:300;">Let's Get<br><strong style="font-size:1.2em; color:#2c3e50;">Started!</strong></div>
                <div class="input-group"><i class='bx bx-envelope'></i><input type="email" placeholder="Email Address" value="jame@skillup.com"></div>
                <div class="input-group"><i class='bx bx-lock-alt'></i><input type="password" placeholder="Password" value="password"></div>
                <button class="btn-main" onclick="enterApp()">SIGN IN</button>
                <div class="auth-switch-text" onclick="toggleAuthMode('signup')">Don't have an account? <strong>Sign up</strong></div>
            </div>

            <!-- Signup Form -->
            <div id="signup-form" class="auth-form-container">
                 <div style="text-align:center; margin-bottom:20px; font-size:1.5em; font-weight:300;">Create an<br><strong style="font-size:1.2em; color:#2c3e50;">Account!</strong></div>
                 <div class="input-group"><i class='bx bx-user'></i><input type="text" placeholder="Username"></div>
                 <div class="input-group"><i class='bx bx-envelope'></i><input type="email" placeholder="Email Address"></div>
                 <div class="input-group"><i class='bx bx-lock-alt'></i><input type="password" placeholder="Password"></div>
                 <div class="input-group"><i class='bx bx-lock-alt'></i><input type="password" placeholder="Confirm Password"></div>
                 <button class="btn-main" onclick="enterApp()">SIGN UP</button>
                 <div class="auth-switch-text" onclick="toggleAuthMode('login')">Already have an account? <strong>Sign in</strong></div>
            </div>
        </div>

        <!-- 2. 主应用 -->
        <div id="app" class="app-content">
            <div class="top-section">
                <div class="top-nav-container">
                    <div class="top-nav">
                        <div class="stats-header-btn" onclick="openPage('stats-page')">
                            <i class='bx bxs-star-half' style="margin-right:8px; font-size: 1.2em;"></i> Statistics
                        </div>
                        <div style="display:flex; gap:10px; align-items:center;">
                            <!-- 消息提醒 -->
                            <div class="notification-wrapper">
                                <div class="notification-badge" onclick="toggleNotif()">
                                    <!-- Give this icon a unique ID for click listener exclusion -->
                                    <i id="notif-icon" class='bx bx-bell' style="font-size:1.6em; color:#333;"></i> 
                                    <div class="badge-dot"></div>
                                </div>
                                <!-- 气泡 -->
                                <div id="notif-bubble" class="notif-bubble">
                                    <!-- Notification items will be injected here by JS -->
                                </div>
                            </div>
                            
                            <div class="user-avatar-top" onclick="openPage('stats-page')"><i class='bx bxs-user'></i></div>
                        </div>
                    </div>
                    <div class="search-pill">
                        <i class='bx bx-search' style="color:#999; font-size: 1.2em;"></i>
                        <input type="text" id="search-input" placeholder="Search skills, friends or leaders..." onkeyup="handleSearch()">
                    </div>
                </div>
            </div>

            <div class="nav-tabs">
                <button class="nav-tab active" id="tab-all" onclick="switchTab('all')">All</button>
                <button class="nav-tab" id="tab-skills" onclick="switchTab('skills')">Skills</button>
                <button class="nav-tab" id="tab-friends" onclick="switchTab('friends')">Friends</button>
                <button class="nav-tab" id="tab-leaderboard" onclick="switchTab('leaderboard')">Leaderboard</button>
            </div>

            <div class="content-area">
                <div id="grid-container" class="grid-container"></div>
                <div id="leaderboard-content" class="hidden">
                    <ul class="leaderboard-list" id="lb-list">
                        <!-- Leaderboard items will be injected here -->
                    </ul>
                </div>
                
                <!-- 加载更多朋友按钮 -->
                <div id="load-more-friends" onclick="loadAllFriends()">Load More Friends (Show All)</div>
                
                <div id="no-result" style="text-align:center; color:#777; display:none; padding-top: 20px;">No results found.</div>
            </div>
        </div>

        <!-- 3. 统计页面 (未修改) -->
        <div id="stats-page" class="fullscreen-modal">
            <div class="modal-content-wrapper">
                <div class="modal-header-cyan">
                    <div class="back-circle" onclick="closePage('stats-page')"><i class='bx bx-left-arrow-alt'></i></div>
                    <div class="page-title">Statistics</div>
                    <div class="user-avatar-top"><i class='bx bxs-user'></i></div>
                </div>
                <div class="detail-content-scroll">
                    <h3 style="text-align:center; color:#555;">Detailed User Statistics and Achievements</h3>
                    <p style="color:#777; text-align:center;">This section would display your current progress, skill ratings, and overall score.</p>
                </div>
            </div>
        </div>

        <!-- 4. 技能详情页面 (未修改) -->
        <div id="skill-detail-page" class="fullscreen-modal">
            <div class="modal-content-wrapper">
                <div class="modal-header-cyan">
                    <div class="back-circle" onclick="closePage('skill-detail-page')"><i class='bx bx-left-arrow-alt'></i></div>
                    <div class="page-title" id="sd-title">Crochet</div>
                    <div class="user-avatar-top"><i class='bx bxs-user'></i></div>
                </div>
                
                <div class="detail-content-scroll">
                    <!-- Phase 1: Intro + Instructions (始终显示) -->
                    <div id="phase-1" class="skill-phase">
                        <img src="" id="sd-img" style="width:100%; max-height:300px; object-fit:cover; border-radius:15px; margin-bottom:20px;">
                        <p id="sd-desc" style="line-height:1.6; color:#333;"></p>
                        <div style="margin: 10px 0;"><strong>Difficulty:</strong> <span id="sd-stars" style="color:#F1C40F;"></span></div>
                        
                        <!-- Instruction 区域 -->
                        <h3 style="margin-bottom:10px; border-bottom: 2px solid #ccc; padding-bottom: 5px;">Instruction Steps:</h3>
                        <ul class="instructions-list">
                            <li>1. Watch the introductory lesson video.</li>
                            <li>2. Practice the foundational technique for 30 minutes.</li>
                            <li>3. Launch the official challenge in the app.</li>
                            <li>4. Post a photo of your completed first work to share with friends.</li>
                        </ul>
                        
                        <!-- Steps/Challenge Section (默认展示 Challenge 步骤) -->
                        <h3 style="margin-top:20px; border-bottom: 2px solid #ccc; padding-bottom: 5px;">Your Progress:</h3>
                        <div id="phase-2" class="skill-phase-2" style="display:block; padding: 0;">
                            <div class="step-block">
                                <div class="step-arrow-container"><div class="blue-arrow-shape">1</div><span style="font-weight: 600;">Watch Video Lesson</span></div>
                                <div class="step-video-placeholder" style="background:#ddd; height:100px; border-radius:10px; display:flex; align-items:center; justify-content:center; flex-direction:column; color:#555;"><i class='bx bx-play-circle' style="font-size:3em;"></i><span>Watch video</span></div>
                            </div>
                            <div class="step-block">
                                <div class="step-arrow-container"><div class="blue-arrow-shape">2</div><span style="font-weight: 600;">Practice Time (30 min)</span></div>
                                <p style="margin-top: 5px; margin-left: 65px; font-size: 0.9em; color: #555;">Start a timer for focused practice.</p>
                            </div>
                            <div class="step-block">
                                <div class="step-arrow-container"><div class="blue-arrow-shape">3</div><span style="font-weight: 600;">Launch Challenge</span></div>
                                <div class="step-video-placeholder" style="height:100px; background:#2ECC71; border-radius:10px; display:flex; align-items:center; justify-content:center; flex-direction:column; color:white;"><i class='bx bx-check-circle' style="font-size:3em;"></i><span>Challenge Active!</span></div>
                            </div>
                            <div class="step-block">
                                <div class="step-arrow-container"><div class="blue-arrow-shape">4</div><span style="font-weight: 600;">Share Your Work</span></div>
                                <div class="step-icons" style="display:flex; gap:15px; margin-left:65px;">
                                    <i class='bx bx-image' style="font-size:2em; cursor:pointer;" title="Upload Photo"></i> 
                                    <i class='bx bxs-camera' style="font-size:2em; color:#2D9CDB; cursor:pointer;" title="Take Photo"></i>
                                </div>
                            </div>
                            <div class="completion-card" onclick="openChat('Skill Group')">
                                <h3 style="margin:0;">View Friend Progress</h3>
                                <p style="text-decoration:underline; font-weight:bold; font-size:0.9em;">Click to see what your friends are making.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 5. 好友/排行榜资料页 -->
        <div id="profile-page" class="fullscreen-modal">
             <div class="modal-content-wrapper">
                <div class="modal-header-cyan">
                    <div class="back-circle" onclick="closePage('profile-page')"><i class='bx bx-left-arrow-alt'></i></div>
                    <div class="page-title" id="p-name">Maya Heck</div>
                    <div class="user-avatar-top"><i class='bx bxs-user'></i></div>
                </div>
                <div class="detail-content-scroll" style="text-align:center;">
                    <div id="profile-content">
                        <!-- Profile content will be injected here -->
                    </div>
                </div>
             </div>
        </div>

        <!-- 6. 聊天弹窗 (未修改) -->
        <div id="chat-modal">
            <div class="chat-content-wrapper">
                <div class="chat-header">
                    <h3 style="margin:0;" id="chat-title">Rachel Green</h3>
                    <i class='bx bx-x' style="font-size:1.5em; cursor:pointer;" onclick="closeChat()"></i>
                </div>
                <div class="chat-body">
                    <div class="chat-message">Hey! Are you free to join the cooking challenge today?</div>
                </div>
                <div class="chat-footer">
                    <input type="text" class="chat-input" placeholder="Type a message...">
                    <button style="background:#2D9CDB; color:white; border:none; border-radius:50%; width:40px; height:40px; cursor:pointer;"><i class='bx bxs-send'></i></button>
                </div>
            </div>
        </div>

    </div> <!-- End of root-frame -->

    <script>
        // Data
        const skillsData = [
            { id: 1, title: "Crochet", keywords: "knitting, yarn, 钩针, 编织", type: "skill", img: "https://placehold.co/300x200/FFD1DC/555?text=Crochet", stars: 3, desc: "Needlework technique used to interlace loops of yarn. Learn the basic stitches, read patterns, and finish your first simple project." },
            { id: 2, title: "100,000 steps in 10 days", keywords: "walking, run, 走路, 跑步", type: "skill", img: "https://placehold.co/300x200/AED6F1/555?text=Walking", stars: 5, desc: "Challenge yourself to walk 10,000 steps every day for 10 days. Focus on consistency and hydration." },
            { id: 3, title: "Talk to 5 new people", keywords: "social, conversation, 社交, 聊天", type: "skill", img: "https://placehold.co/300x200/F9E79F/555?text=Social", stars: 3, desc: "Step out of your comfort zone. Learn conversation starters and practice active listening in five different interactions." },
            { id: 4, title: "1 new recipe a day", keywords: "cooking, food, 烹饪, 食谱", type: "skill", img: "https://placehold.co/300x200/A2D9CE/555?text=Cooking", stars: 4, desc: "Enhance your culinary skills. Commit to learning and executing one entirely new recipe daily for a week." },
            { id: 5, title: "8 hours of sleep", keywords: "rest, sleep, 休息, 睡眠", type: "skill", img: "https://placehold.co/300x200/D2B4DE/555?text=Sleep", stars: 3, desc: "Focus on improving your sleep hygiene. Track your sleep, establish a calming routine, and aim for 8 hours for 14 consecutive nights." },
            { id: 6, title: "No leftover day", keywords: "food, waste, 食物, 浪费", type: "skill", img: "https://placehold.co/300x200/F5CBA7/555?text=No+Leftover", stars: 4.5, desc: "Finish everything on your plate! Practice mindful eating and portion control to eliminate food waste during mealtimes." }
        ];
        
        // 增加更多朋友数据，并添加 score/completedSkills 字段用于排行榜
        const peopleData = [
            { id: 101, title: "Kyle Brown", keywords: "kyle, 朋友", type: "person", img: "https://placehold.co/300x300/D7BDE2/555?text=Kyle", subtitle: "3+ Mutuals", verified: false, score: 950, completedSkills: 5, currentSkills: ["Crochet", "1 new recipe a day"]},
            { id: 102, title: "Felisha L", keywords: "felisha, 朋友", type: "person", img: "https://placehold.co/300x300/F9E79F/555?text=Felisha", subtitle: "1+ Mutuals", verified: false, score: 1200, completedSkills: 8, currentSkills: ["8 hours of sleep"]},
            { id: 103, title: "Ellie Kim", keywords: "ellie, 朋友", type: "person", img: "https://placehold.co/300x300/85C1E9/555?text=Ellie", subtitle: "In contacts", verified: false, score: 780, completedSkills: 4, currentSkills: ["Talk to 5 new people", "No leftover day"]},
            { id: 104, title: "Maya Heck", keywords: "maya, 朋友", type: "person", img: "https://placehold.co/300x300/FF9A9E/555?text=Maya", subtitle: "New", verified: true, score: 1550, completedSkills: 12, currentSkills: ["1 new recipe a day"]},
            { id: 105, title: "Casey Fijate", keywords: "casey, 朋友", type: "person", img: "https://placehold.co/300x300/E6B0AA/555?text=Casey", subtitle: "1+ Mutuals", verified: false, score: 1800, completedSkills: 15, currentSkills: []},
            { id: 106, title: "Chad Dennis", keywords: "chad, 朋友", type: "person", img: "https://placehold.co/300x300/CCD1D1/555?text=Chad", subtitle: "17+ Mutuals", verified: false, score: 600, completedSkills: 3, currentSkills: ["100,000 steps in 10 days"]},
            
            // 更多朋友数据用于 '加载更多' 功能
            { id: 107, title: "Rachel G", keywords: "rachel, 朋友", type: "person", img: "https://placehold.co/300x300/A18CD1/555?text=R", subtitle: "10+ Mutuals", verified: false, score: 1350, completedSkills: 9, currentSkills: ["Crochet"]},
            { id: 108, title: "Ross Geller", keywords: "ross, 朋友", type: "person", img: "https://placehold.co/300x300/AED6F1/555?text=G", subtitle: "6+ Mutuals", verified: false, score: 450, completedSkills: 2, currentSkills: ["Talk to 5 new people"]},
            { id: 109, title: "Monica Bing", keywords: "monica, 朋友", type: "person", img: "https://placehold.co/300x300/F9E79F/555?text=B", subtitle: "8+ Mutuals", verified: true, score: 2000, completedSkills: 20, currentSkills: ["1 new recipe a day"]},
            { id: 110, title: "Joey Tribbiani", keywords: "joey, 朋友", type: "person", img: "https://placehold.co/300x300/FFD1DC/555?text=J", subtitle: "7+ Mutuals", verified: false, score: 300, completedSkills: 1, currentSkills: []},
        ];

        let currentTab = 'all';
        let friendsLimit = 6; // 默认显示的朋友数量

        // --- 认证与主应用切换 ---
        function toggleAuthMode(mode) {
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            if (mode === 'signup') {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
            } else {
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
            }
        }

        window.onload = () => {
             // 确保初始状态正确
             // 注册全局点击事件，用于关闭通知气泡
             setupGlobalNotifCloser();
        }
        
        function enterApp() {
            document.getElementById('auth-screen').classList.add('hidden');
            setTimeout(() => {
                document.getElementById('app').classList.add('visible');
                // 初始化应用内容
                switchTab('all');
                renderNotifBubble(); // 确保通知内容在应用加载后渲染
            }, 300);
        }

        // --- 导航与搜索逻辑 ---

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.nav-tab').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            
            // 切换内容区域显示
            const gridContainer = document.getElementById('grid-container');
            const leaderboardContent = document.getElementById('leaderboard-content');
            const loadMoreBtn = document.getElementById('load-more-friends');

            gridContainer.classList.remove('hidden');
            leaderboardContent.classList.add('hidden');
            loadMoreBtn.classList.add('hidden');

            if (tab === 'leaderboard') {
                gridContainer.classList.add('hidden');
                leaderboardContent.classList.remove('hidden');
                renderLeaderboard();
            } else {
                handleSearch(); // 运行搜索逻辑来渲染 skills 或 friends
            }
        }

        function handleSearch() {
            const query = document.getElementById('search-input').value.toLowerCase().trim();
            const container = document.getElementById('grid-container');
            const loadMoreBtn = document.getElementById('load-more-friends');
            container.innerHTML = ''; 
            
            let allItems = [...skillsData, ...peopleData];
            let filteredItems = [];

            // 1. 根据 Tab 过滤
            if (currentTab === 'skills') {
                allItems = skillsData;
            } else if (currentTab === 'friends') {
                allItems = peopleData;
                // 如果在 friends tab，显示“加载更多”按钮（如果朋友数量超过默认限制且未搜索）
                if (query === '' && peopleData.length > friendsLimit) {
                    loadMoreBtn.classList.remove('hidden');
                }
            } else if (currentTab === 'all') {
                loadMoreBtn.classList.add('hidden'); // 'All' 不显示加载更多
            } else {
                // 如果在排行榜 tab，直接退出，由 switchTab 处理
                return;
            }
            
            // 2. 根据搜索 Query 过滤
            filteredItems = allItems.filter(item => {
                const matchTitle = item.title.toLowerCase().includes(query);
                const matchKeywords = item.keywords ? item.keywords.toLowerCase().includes(query) : false;
                return matchTitle || matchKeywords;
            });
            
            // 3. 渲染结果
            if (filteredItems.length === 0) {
                document.getElementById('no-result').style.display = 'block';
            } else {
                document.getElementById('no-result').style.display = 'none';
                
                // 朋友列表分页逻辑
                if (currentTab === 'friends' && query === '') {
                    const itemsToRender = filteredItems.slice(0, friendsLimit);
                    itemsToRender.forEach(item => container.appendChild(createCard(item)));
                    
                    // 检查是否需要显示 '加载更多'
                    if (filteredItems.length > friendsLimit) {
                        loadMoreBtn.classList.remove('hidden');
                    } else {
                         loadMoreBtn.classList.add('hidden');
                    }
                } else {
                    // All, Skills, 或 Friends 搜索结果，全部显示
                    filteredItems.forEach(item => container.appendChild(createCard(item)));
                    loadMoreBtn.classList.add('hidden');
                }
            }
        }
        
        // 加载所有朋友
        function loadAllFriends() {
            friendsLimit = peopleData.length; // 设置限制为最大数量
            document.getElementById('load-more-friends').classList.add('hidden');
            handleSearch(); // 重新渲染所有朋友
        }


        function createCard(item) {
            const div = document.createElement('div');
            div.className = 'cyan-card';
            if (item.type === 'skill') {
                let starHtml = '';
                for(let i=0; i<Math.floor(item.stars); i++) starHtml += '★';
                if(item.stars % 1 !== 0) starHtml += '½';
                div.innerHTML = `
                    <img src="${item.img}" class="card-img" alt="${item.title} Skill Image" onerror="this.onerror=null; this.src='https://placehold.co/300x200/A0F0FA/555?text=Skill'">
                    <div class="card-title">${item.title}</div>
                    <div class="card-subtitle">Difficulty</div>
                    <div class="card-stars">${starHtml}</div>
                    <div class="btn-circle-plus"><i class='bx bx-plus'></i></div>
                `;
                div.onclick = () => openSkillDetail(item);
            } else {
                div.innerHTML = `
                    <img src="${item.img}" class="card-img" alt="${item.title} Profile Image" onerror="this.onerror=null; this.src='https://placehold.co/300x200/A0F0FA/555?text=Friend'">
                    <div class="card-title">${item.title}</div>
                    <div class="card-subtitle">${item.subtitle}</div>
                    <div class="btn-circle-plus"><i class='bx bx-message'></i></div>
                `;
                div.onclick = () => openProfileData(item.id, item.title);
                // 朋友卡片点击加号是打开聊天
                div.querySelector('.btn-circle-plus').onclick = (e) => {
                    e.stopPropagation();
                    openChat(item.title);
                };
            }
            return div;
        }

        // --- 排行榜逻辑 ---

        function renderLeaderboard() {
            const list = document.getElementById('lb-list');
            list.innerHTML = '';

            // 1. 根据 score 排序，创建排行榜数据副本
            const leaderboard = [...peopleData].sort((a, b) => b.score - a.score);

            leaderboard.forEach((person, index) => {
                const rank = index + 1;
                let rankClass = '';
                if (rank === 1) rankClass = 'gold';
                else if (rank === 2) rankClass = 'silver';
                else if (rank === 3) rankClass = 'bronze';
                
                const item = document.createElement('li');
                item.className = 'leaderboard-item';
                item.onclick = () => openProfileData(person.id, person.title);

                item.innerHTML = `
                    <div class="rank-number ${rankClass}">${rank}</div>
                    <div class="leader-info">
                        <img src="${person.img}" class="leader-avatar" alt="${person.title} Avatar" onerror="this.onerror=null; this.src='https://placehold.co/50x50/A0F0FA/555?text=P'">
                        <div>
                            <div class="leader-name">${person.title}</div>
                            <div class="leader-completed">${person.completedSkills} skills completed</div>
                        </div>
                    </div>
                    <div class="leader-stats">
                        <div class="leader-score">${person.score} pts</div>
                        <i class='bx bx-chevron-right' style="font-size:1.5em; color:#999;"></i>
                    </div>
                `;
                list.appendChild(item);
            });

             document.getElementById('no-result').style.display = 'none';
        }

        // --- 模态框与页面切换 ---
        function openPage(pageId) { document.getElementById(pageId).classList.add('open'); }
        function closePage(pageId) { document.getElementById(pageId).classList.remove('open'); }

        // --- 通知气泡逻辑修复 ---

        // 通知气泡渲染 (每次打开前应该调用或确保内容存在)
        function renderNotifBubble() {
             const bubble = document.getElementById('notif-bubble');
             // 通知内容，使用 data 属性来传递 ID，而不是在 HTML 中直接调用 onclick
             bubble.innerHTML = `
                <div style="display:flex; align-items:center; cursor:pointer;" data-id="104" data-action="profile"> 
                    <img src="https://placehold.co/100x100/FF9A9E/555?text=M" style="width:35px; height:35px; border-radius:50%; margin-right:10px;" alt="Maya Heck">
                    <div style="flex:1;">
                        <div style="font-size:0.9em;"><strong>Maya Heck</strong> has added you.</div>
                        <span style="text-decoration:underline; font-size:0.7em; color:#555;">View Request</span>
                    </div>
                    <div style="color:#2D9CDB;"><i class='bx bx-user-plus'></i></div>
                </div>
                <div style="display:flex; align-items:center; cursor:pointer;" data-id="107" data-action="chat">
                    <img src="https://placehold.co/100x100/A18CD1/555?text=R" style="width:35px; height:35px; border-radius:50%; margin-right:10px;" alt="Rachel Green">
                    <div style="flex:1;">
                        <div style="font-size:0.9em;"><strong>Rachel G</strong> messaged you.</div>
                        <span style="font-size:0.7em; color:#777;">1 hour ago</span>
                    </div>
                    <div style="color:#2D9CDB;"><i class='bx bx-message-rounded-dots'></i></div>
                </div>
             `;
             
             // 为通知项添加事件监听器
             bubble.querySelectorAll('div[data-action]').forEach(item => {
                 item.addEventListener('click', (e) => {
                    const id = parseInt(item.getAttribute('data-id'));
                    const action = item.getAttribute('data-action');
                    const person = peopleData.find(p => p.id === id);
                    if (person) {
                        if (action === 'profile') {
                            openProfileData(id, person.title);
                        } else if (action === 'chat') {
                            openChat(person.title);
                        }
                    }
                    document.getElementById('notif-bubble').classList.remove('show'); // 确保点击后关闭气泡
                 });
             });
        }

        // 切换通知气泡显示状态
        function toggleNotif() { 
            const bubble = document.getElementById('notif-bubble');
            bubble.classList.toggle('show'); 
            // 每次打开都重新渲染以确保事件监听器是最新的
            if (bubble.classList.contains('show')) {
                 renderNotifBubble();
            }
        }
        
        // 注册全局点击事件，用于关闭通知气泡
        function setupGlobalNotifCloser() {
            document.addEventListener('click', function(event) {
                const notifBubble = document.getElementById('notif-bubble');
                // 使用 notification-wrapper 来判断是否点击在通知区域内
                const notifWrapper = document.querySelector('.notification-wrapper');

                // 如果通知气泡是打开状态，并且点击的目标不在通知区域内
                if (notifBubble.classList.contains('show') && !notifWrapper.contains(event.target)) {
                    notifBubble.classList.remove('show');
                }
            });
        }

        function openChat(name) {
            document.getElementById('chat-title').innerText = name;
            document.getElementById('chat-modal').classList.add('open');
            document.getElementById('notif-bubble').classList.remove('show');
        }
        function closeChat() { document.getElementById('chat-modal').classList.remove('open'); }

        function openSkillDetail(skill) {
            document.getElementById('sd-title').innerText = skill.title;
            document.getElementById('sd-img').src = skill.img;
            document.getElementById('sd-desc').innerText = skill.desc;
            
            let starHtml = '';
            for(let i=0; i<Math.floor(skill.stars); i++) starHtml += '★';
            if(skill.stars % 1 !== 0) starHtml += '½';
            document.getElementById('sd-stars').innerHTML = starHtml; 

            openPage('skill-detail-page');
        }

        // 打开用户资料页（适用于朋友卡片和排行榜点击）
        function openProfileData(id, name) {
            const person = peopleData.find(p => p.id === id) || peopleData[3]; 
            document.getElementById('p-name').innerText = name;
            
            const profileContentDiv = document.getElementById('profile-content');
            
            const completedList = person.currentSkills.length > 0
                ? person.currentSkills.map(skill => `<li style="display:flex; align-items:center;"><i class='bx bxs-check-circle' style="color:#2ecc71; font-size:1.2em; margin-right:8px;"></i> ${skill} (In Progress)</li>`).join('')
                : `<li style="color:#777;">This user is currently not working on any public skills.</li>`;

            // 假设已完成的技能，用于展示排行榜详情
            const inProgressList = person.currentSkills.length > 0
                ? person.currentSkills.map(skill => `<li style="display:flex; align-items:center;"><i class='bx bxs-star-half' style="color:#F1C40F; font-size:1.2em; margin-right:8px;"></i> ${skill} (Completed)</li>`).join('')
                : `<li style="color:#777;">No public skills completed yet.</li>`;

            profileContentDiv.innerHTML = `
                <div style="position:relative; display:inline-block; margin: 20px 0;">
                    <img src="${person.img}" style="width:120px; height:120px; border-radius:50%; object-fit:cover; box-shadow: 0 4px 15px rgba(0,0,0,0.1);" alt="${person.title} Profile" onerror="this.onerror=null; this.src='https://placehold.co/120x120/A0F0FA/555?text=P'">
                    <div style="position:absolute; bottom:0; right:0; background:#2D9CDB; color:white; border-radius:50%; width:30px; height:30px; display:${person.verified ? 'flex' : 'none'}; align-items:center; justify-content:center; border: 3px solid white;"><i class='bx bx-check'></i></div>
                </div>
                
                <h2 style="margin-top:10px; margin-bottom:5px;">${person.title}</h2>
                <p style="color:#666; font-size:1.1em; margin-bottom:20px;">Score: <strong style="color:var(--primary-blue);">${person.score}</strong> | Completed: <strong>${person.completedSkills}</strong> Skills</p>
                
                <div style="text-align:left; margin-top:30px; border-top: 1px solid #eee; padding-top: 20px;">
                    <h3 style="margin-top:0;">Skills in Progress:</h3>
                    <ul class="instructions-list" style="margin-top:10px;">${completedList}</ul>
                    
                    <h3 style="margin-top:30px;">Completed Skills:</h3>
                    <ul class="instructions-list" style="margin-top:10px;">${inProgressList}</ul>

                    <div style="margin-top: 30px; text-align: center;">
                        <button class="btn-main" style="width: 80%; padding: 10px; margin: 0;" onclick="openChat('${person.title}')">
                            <i class='bx bx-message-dots'></i> Send Message
                        </button>
                    </div>
                </div>
            `;
            
            openPage('profile-page');
            document.getElementById('notif-bubble').classList.remove('show');
        }
    </script>
</body>
</html>